/*;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;
;;  galag: precise re-implementation of a popular space shoot-em-up
;;  new_stage.s (gg1-3.2m)
;;
;;  table data management for the game stages
;;
;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;;*/
/*
 ** header file includes
 */
#include "galag.h"

/*
 ** defines and typedefs
 */

/*
 ** extern declarations of variables defined in other files
 */

/*
 ** non-static external definitions this file or others
 */
uint8 ds_new_stage_parms[0x0A];

/*
 ** static external definitions in this file
 */
// variables
static uint8 flt_dat_atk_ptns_lut[];
static const uint8 db_flt_dat_atk_ptns[][130];
static const uint8 db_flt_dat_atk_ptns[][130];


/*=============================================================================
;; c_2C00()
;;  Description:
;;   new stage setup
;;   selects data table based on level and difficulty setting
;; IN:
;;  ...
;; OUT:
;;  ...
;;----------------------------------------------------------------------------*/
void c_2C00_new_stg_setup(void)
{
    uint8 iHL;
    uint8 A, E, L;

    A = plyr_state_actv.stage_ctr;

    while (A > 0x1B)
        A -= 4;

    // adjusted level (numbered from 0) and multiply by 5
    A -= 1;
    L = A;
    A <<= 2;
    E = L + A;

    iHL = flt_dat_atk_ptns_lut[mchn_cfg.rank];

    for ( L = 0; L < 5; L++ )
    {
        A = db_flt_dat_atk_ptns[iHL][E + L];

        ds_new_stage_parms[L * 2 + 0] = (A & 0xF0) >> 4;
        ds_new_stage_parms[L * 2 + 1] = A & 0x0F;
    }

    // set ds_new_stage_parms[0x05]
    A = plyr_state_actv.stage_ctr;
    if (A < 3)
    {
        A = 0x00;
    }
    else if (A == (plyr_state_actv.stage_ctr | 0x0FC))
    {
        A = 0x0A;
    }
    ds_new_stage_parms[5 * 2] = A;

    // I don't understand these right now
    b_92C0_0[0] = 0x16;
    b_92C0_0[1] = 0x02;
    b_92C0_0[2] = 0x02;

    // adjust star speed
}


/*=============================================================================
; address table for _2C14
; selected table is by the difficulty (rank) configured by dip switch setting
;;----------------------------------------------------------------------------*/
/*
 * lookup by difficulty level
 */
static uint8 flt_dat_atk_ptns_lut[] =
{
    1, 2, 3, 0
};

// each of these table entries if $82 (130) bytes
static const uint8 db_flt_dat_atk_ptns[][130] =
{
    {
        0x00,0x00,0x22,0xC6,0x00,0x00,0x11,0x23,0xC7,0x00,0x00,0x00,0x00,
        0xC0,0x00,0x11,0x12,0x23,0x97,0x00,0x11,0x23,0x23,0x98,0x00,0x21,
        0x24,0x33,0x98,0x00,0x00,0x00,0x00,0x90,0x00,0x22,0x25,0x33,0x99,
        0x10,0x22,0x36,0x34,0x69,0x10,0x10,0x11,0x23,0x97,0x00,0x00,0x00,
        0x00,0x60,0x00,0x32,0x46,0x34,0x67,0x11,0x32,0x67,0x44,0x68,0x11,
        0x32,0x67,0x45,0x68,0x11,0x00,0x00,0x00,0x60,0x00,0x42,0x78,0x45,
        0x69,0x11,0x42,0x78,0x45,0x69,0x11,0x11,0x22,0x23,0x97,0x11,0x00,
        0x00,0x00,0x60,0x00,0x52,0x88,0x46,0x3A,0x11,0x52,0x88,0x56,0x3A,
        0x11,0x52,0x88,0x56,0x3C,0x11,0x00,0x00,0x00,0x30,0x00,0x62,0x89,
        0x57,0x3C,0x11,0x62,0x99,0x57,0x3C,0x11,0x62,0x99,0x57,0x3C,0x11
    },
    {
        0x00,0x00,0x12,0xC6,0x00,0x00,0x11,0x22,0xC6,0x00,0x00,0x00,0x00,
        0xC0,0x00,0x11,0x12,0x23,0x97,0x00,0x11,0x12,0x23,0x97,0x00,0x00,
        0x11,0x23,0xC7,0x00,0x00,0x00,0x00,0x90,0x00,0x21,0x23,0x33,0x98,
        0x10,0x21,0x24,0x33,0x98,0x10,0x21,0x25,0x34,0x98,0x10,0x00,0x00,
        0x00,0x60,0x00,0x22,0x25,0x34,0x68,0x11,0x32,0x36,0x44,0x68,0x11,
        0x11,0x11,0x23,0x67,0x01,0x00,0x00,0x00,0x60,0x00,0x32,0x36,0x45,
        0x68,0x11,0x32,0x46,0x45,0x69,0x11,0x32,0x67,0x45,0x69,0x11,0x00,
        0x00,0x00,0x60,0x00,0x42,0x67,0x46,0x3A,0x11,0x42,0x78,0x56,0x3A,
        0x11,0x52,0x78,0x56,0x3A,0x11,0x00,0x00,0x00,0x30,0x00,0x52,0x88,
        0x56,0x3C,0x11,0x62,0x99,0x57,0x3C,0x11,0x62,0x99,0x57,0x3C,0x11
    },
    {
        0x00,0x00,0x23,0xC6,0x00,0x10,0x11,0x23,0x97,0x00,0x00,0x00,0x00,
        0xC0,0x00,0x11,0x12,0x33,0x98,0x00,0x21,0x23,0x34,0x68,0x00,0x21,
        0x24,0x34,0x68,0x00,0x00,0x00,0x00,0x90,0x00,0x32,0x36,0x34,0x67,
        0x10,0x32,0x46,0x44,0x68,0x10,0x11,0x11,0x23,0x97,0x10,0x00,0x00,
        0x00,0x60,0x00,0x42,0x67,0x45,0x68,0x11,0x42,0x67,0x45,0x69,0x11,
        0x42,0x78,0x46,0x69,0x11,0x00,0x00,0x00,0x60,0x00,0x52,0x78,0x46,
        0x3A,0x11,0x52,0x88,0x56,0x3A,0x11,0x52,0x88,0x56,0x3A,0x11,0x00,
        0x00,0x00,0x60,0x00,0x62,0x88,0x56,0x3C,0x11,0x62,0x89,0x57,0x3C,
        0x11,0x62,0x89,0x57,0x3E,0x11,0x00,0x00,0x00,0x30,0x00,0x72,0x99,
        0x57,0x3E,0x11,0x72,0x99,0x68,0x3E,0x11,0x72,0x99,0x68,0x3E,0x11
    },
    {
        0x00,0x00,0x23,0xC6,0x00,0x10,0x11,0x23,0x97,0x00,0x00,0x00,0x00,
        0xC0,0x00,0x11,0x12,0x34,0x98,0x00,0x21,0x23,0x34,0x68,0x00,0x21,
        0x24,0x34,0x68,0x00,0x00,0x00,0x00,0x90,0x00,0x32,0x36,0x45,0x67,
        0x11,0x32,0x46,0x46,0x68,0x11,0x32,0x56,0x46,0x69,0x11,0x00,0x00,
        0x00,0x60,0x00,0x42,0x67,0x56,0x6A,0x11,0x42,0x67,0x56,0x6A,0x11,
        0x42,0x78,0x57,0x6A,0x11,0x00,0x00,0x00,0x60,0x00,0x52,0x78,0x57,
        0x3A,0x11,0x52,0x88,0x57,0x3A,0x11,0x52,0x88,0x68,0x3C,0x11,0x00,
        0x00,0x00,0x60,0x00,0x62,0x88,0x68,0x3C,0x11,0x62,0x89,0x68,0x3C,
        0x11,0x62,0x89,0x68,0x3E,0x11,0x00,0x00,0x00,0x30,0x00,0x72,0x99,
        0x68,0x3E,0x11,0x72,0x99,0x68,0x3E,0x11,0x72,0x99,0x68,0x3E,0x11
    }
};
